- name: site | create satellite VM
  hosts: kvm
  become: false
  roles:
    - role: libvirt
      when: satellite_enable_virt

- name: site | snapshot satellite VM
  hosts: kvm
  become: false
  roles:
    - role: snapshot
      vars:
        vm: "{{ satellite_hostname }}"
        snap_name: "a-post-kickstart"
      when: satellite_enable_snap1

- name: site |  rhsm & yum update
  hosts: mgmt
  roles:
    - role: rhsm
    - role: yumupdate
      when: satellite_enable_rhsm_yum

- name: site | snapshot satellite VM
  hosts: kvm
  become: false
  roles:
    - role: snapshot
      vars:
        vm: "{{ satellite_hostname }}"
        snap_name: "b-post-rhsm-and-yum-update"
      when: satellite_enable_snap2

- name: site | install satellite proper
  hosts: mgmt
  roles:
    - role: install
      when: satellite_enable_install

- name: site | snapshot satellite VM
  hosts: kvm
  become: false
  roles:
    - role: snapshot
      vars:
        vm: "{{ satellite_hostname }}"
        snap_name: "c-post-install"
      when: satellite_enable_snap3

- name: site | upload manifest, enable and sync content repos
  hosts: mgmt
  roles:
    - role: content
      when: satellite_enable_content

- name: site | snapshot satellite VM
  hosts: kvm
  become: false
  roles:
    - role: snapshot
      vars:
        vm: "{{ satellite_hostname }}"
        snap_name: "d-post-content"
      when: satellite_enable_snap4

- name: site | configure satellite
  hosts: mgmt
  roles:
    - role: config
      when: satellite_enable_config

- name: site | snapshot satellite VM
  hosts: kvm
  become: false
  roles:
    - role: snapshot
      vars:
        vm: "{{ satellite_hostname }}"
        snap_name: "e-post-config"
      when: satellite_enable_snap5
